<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendrier de l‚ÄôAvent Cambon Partners</title>

  <!-- Police script pour le sous-titre -->
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Palette & tokens */
      --bg:#F5ECE2;          /* Fond beige principal */
      --card:#F5ECE2;        /* Fond clair des cartes et du modal */
      --ink:#2b1f1f;         /* Texte principal */
      --muted:#7f8aa3;       /* Texte secondaire */
      --accent:#e0b567;      /* Dor√© (confettis/d√©tails) */
      --accent-2:#2d8a6a;    /* Vert succ√®s */
      --danger:#b51212;      /* Rouge erreur */
      --red:#BE1917;         /* Rouge √©l√©gant */
      --shadow:0 8px 18px rgba(0,0,0,.10); /* Ombre douce */
    }

    html, body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:"Times New Roman", serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    *{ box-sizing:border-box; }

    .wrap{
      max-width:1100px;
      margin:64px auto 0;
      padding:0 20px;
    }

    /* Header */
    .title{
      text-align:center;
      font-size:54px;
      font-weight:500;
      color:var(--red);
      line-height:1.25;
    }
    .subtitle{
      text-align:center;
      font-family:"Parisienne", cursive;
      font-size:40px;
      color:var(--red);
      margin-top:6px;
    }

    /* Toolbar */
    .toolbar{
      display:flex;
      gap:12px;
      justify-content:flex-end;
      max-width:1100px;
      margin:28px auto 24px;
      padding:0 20px;
    }
    .pill{
      background:rgba(255,255,255,.4);
      border:1px solid rgba(0,0,0,.08);
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      color:#6c6a6a;
    }
    .btn{
      background:#000;
      color:#fff;
      border-radius:6px;
      border:none;
      padding:8px 14px;
      font-weight:600;
      cursor:pointer;
      transition:background .2s ease;
    }
    .btn:hover{ transform:translateY(-1px); }

    /* Grille */
    .grid{
      display:grid;
      grid-template-columns:repeat(6, minmax(120px, 1fr));
      gap:18px;
      margin-top:28px;
    }
    @media (max-width:900px){ .grid{ grid-template-columns:repeat(4, minmax(100px,1fr)); } }
    @media (max-width:600px){ .grid{ grid-template-columns:repeat(3, minmax(90px,1fr)); } }

    .door{
      position:relative;
      background:var(--card);
      border:none;
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:200;
      font-size:48px;
      letter-spacing:.5px;
      box-shadow:var(--shadow);
      overflow:hidden;
      transition:all .2s ease-in-out;
      color:var(--red);
      cursor:pointer;
      font-family:"Times New Roman";
    }
    .door:hover:not(.opened){
      box-shadow:0 10px 18px rgba(0,0,0,.12);
      transform:translateY(-2px);
    }
    .door.locked{
      cursor:not-allowed;
      filter:none;
      opacity:1;
    }
    .door.opened{
      background:#F5ECE2;
      box-shadow:none;
      border:none;
    }
    .door .num{
      position:absolute;
      top:8px; left:10px;
      color:var(--red);
      font-size:32px;
      font-weight:500;
      z-index:2;
    }
    .door.opened .num{ color:#D9A0A0; }
    .door .icon{
      position:absolute;
      bottom:8px;
      right:8px;
      width:50px;
      height:50px;
      object-fit:contain;
      opacity:0.6;
      transition:opacity .2s ease;
    }
    .door:hover:not(.opened) .icon{ opacity:0.8; }
    .door.opened .icon{ opacity:0.25; }

    
    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background:none;
      backdrop-filter:blur(6px);
      display:none;
      align-items:flex-start; justify-content:center;
      padding-top:12vh; z-index:50;
    }
    .modal{
      width:min(760px, calc(100vw - 32px));
      background:#F4ECE3;
      border:1px solid rgba(0,0,0,.08);
      border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,.12);
      overflow:hidden;
      color:var(--ink);
      transform:translateY(0);
      transition:transform .25s ease;
      font-family:"Times New Roman", serif;
    }
    .modal.shake{ animation:shake .3s ease; }
    @keyframes shake{
      0%{transform:translateX(0)} 20%{transform:translateX(-8px)}
      40%{transform:translateX(8px)} 60%{transform:translateX(-5px)}
      80%{transform:translateX(5px)} 100%{transform:translateX(0)}
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:20px 33px;
    }
    .modal-title{
      font-size:64px; font-weight:500; color:var(--red);
      letter-spacing:.5px;
    }
    .modal-close{
      background:transparent; border:none; font-size:24px; color:#846;
      cursor:pointer;
    }
    .modal-body{ padding:10px 33px 20px; }

    .anecdote{
      background:none;
      border:none;
      padding:8px 0 12px;
      font-size:18px;
      line-height:1.6;
      color:#BE1917;
    }

    .form{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:18px;
    }
    .hint{
      font-family:"Parisienne";
      font-size:20px;
      color:#2b1f1f;
      margin-bottom:4px;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
    }
    @media (max-width:560px){ .row{ flex-direction:column; align-items:stretch; } }

    select{
      flex:1;
      padding:8px 10px;
      border-radius:6px;
      border:1px solid rgba(0,0,0,.2);
      background:#F4ECE3;
      color:#2b1f1f;
      font-family:"Times New Roman", serif;
      font-size:15px;
      outline:none;
    }

    .result{ margin-top:10px; font-weight:700; }
    .ok{ color:var(--accent-2); }
    .ko{ color:var(--danger); }

    .media{
      display:none; margin-top:14px;
    }
    .media iframe, .media video{
      width:100%; aspect-ratio:16/9; border:0; border-radius:12px;
      background:#000;
      animation:popIn .6s ease;
    }
    @keyframes popIn{
      from{ opacity:0; transform:scale(.95); }
      to{ opacity:1; transform:scale(1); }
    }

    .footer{ margin-top:12px; display:flex; justify-content:flex-end; }

    /* Petit style pour le message gagnant */
    .win-msg{ margin-top:8px; }
    .watch-tip{ margin-top:4px; font-style:italic; opacity:.85; }

    /* Confettis */
    .confetti{ position:fixed; pointer-events:none; inset:0; overflow:hidden; z-index:60; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">Le Calendrier de l‚ÄôAvent Cambon Partners</div>
    <div class="subtitle">√Ä qui appartient le FunFact du jour ?</div>

    <div class="grid" id="grid"></div>
  </div>

  <div class="toolbar">
    <span class="pill" id="today-pill"></span>
    <button class="btn" id="toggle-dev">Mode test</button>
    <button class="btn" id="reset">R√©initialiser</button>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" id="modalBox">
      <div class="modal-head">
        <div class="modal-title" id="modal-title">01</div>
        <button class="modal-close" id="close">√ó</button>
      </div>

      <div class="modal-body">
        <div class="anecdote" id="anecdote"></div>

        <div class="form">
          <label class="hint">√Ä qui appartient ce FunFact ?</label>
          <div class="row">
            <select id="answerSelect"></select>
            <button class="btn" id="submit">Valider</button>
          </div>

          <div class="result" id="result"></div>

          <!-- Zone m√©dia (vid√©o YouTube/Drive ou MP4) -->
          <div class="media" id="media"></div>
        </div>

        <div class="footer"></div>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="confetti"></canvas>

  <script>
    /***************
     * CONFIG TEAM *
     ***************/
    const TEAM = [
     "Ad√®le","Alain","Alexandra","Alexandre A.","Alexandre C.","Alexandre H.","Am√©lie","Anna","Annabelle","Anselme","Aubert",
     "Baptiste","Briac","Camille","Carine","Chadi","David","Elena","Florian","Gaian√©","Gabriel","Gr√©goire","Guillaume E.",
     "Guillaume T.","Jeremy","Jonathan","Jordan","Julien","Juliette","Laurent A.","Laurent N.", "Lily","Louis","Luca","Marius","Mathieu","Maxime",
     "Maxime P.","Michael","Min","Morgann","Mostapha","Nathalie","Nicolas O.","Nicolas P.","Nicolas R.","Nicolas SP.","Paul","Pauline",
     "Pierre","Rapha√´l","Robin","Romain D","Romain P.","Simon","T√©lio","Thomas A.","Thomas B.","Thomas K.","Victor","Yahia","Younes","Yvette"
    ];

    /********************
     * 24 JOURS (d√©mo)  *
     ********************/
  
    const DAY_IMAGES = {
      1: "img-calendrier 2/etoile-2.png",
      2: "img-calendrier 2/houx.png",
      3: "img-calendrier 2/etoile-1.png",
      4: "img-calendrier 2/cloche.png",
      5: "img-calendrier 2/boule.png",
      6: "img-calendrier 2/cloche.png",
      7: "img-calendrier 2/etoile-1.png",
      8: "img-calendrier 2/ours.png",
      9: "img-calendrier 2/houx.png",
      10: "img-calendrier 2/cloche.png",
      11: "img-calendrier 2/houx.png",
      12: "img-calendrier 2/sucre.png",
      13: "img-calendrier 2/sucre.png",
      14: "img-calendrier 2/etoile-1.png",
      15: "img-calendrier 2/sapin-traits.png",
      16: "img-calendrier 2/etoile-2.png",
      17: "img-calendrier 2/cadeau.png",
      18: "img-calendrier 2/bougies.png",
      19: "img-calendrier 2/cloche.png",
      20: "img-calendrier 2/sapin-courbe.png",
      21: "img-calendrier 2/cadeau.png",
      22: "img-calendrier 2/etoile-1.png",
      23: "img-calendrier 2/bougies.png",
      24: "img-calendrier 2/houx.png"
    };

    const DAYS = [
      {
        day: 1,
        anecdote: "J'ai failli me faire kidnapper au Mexique",
        answer: "Mostapha",
        video: "https://drive.google.com/file/d/1nQEY2F6fqhStbtDQpA_JFp1x2wQVifS5/preview" // exemple Drive
      },

            {
        day: 2,
        anecdote: "Enfant, j'ai vol√© dans le jet priv√© de Johnny Hallyday",
        answer: "Thomas K.",
        video: "https://drive.google.com/file/d/1zPWYlpBRAbAIJwNxg1_lO20FIuzX8BME/preview" // exemple Drive
      },

            {
        day: 3,
        anecdote: "J'ai d√©jeun√© avec Bernard Tapie dans son c√©l√®bre h√¥tel particulier de la rue des Saint-P√®res",
        answer: "Laurent A.",
        video: "https://drive.google.com/file/d/1ez5RPwNs_E8EQl7VXjWqDX7EeGT-XUuD/preview" // exemple Drive
      },
      {
        day: 4,
        anecdote: "Enfant on m'appelait Harry Potter car j'ai une cicatrice sur le front",
        answer: "Camille",
        video: "https://drive.google.com/file/d/12ZX4z-lmf9ea97JGaEALcVDujAJ10zsE/preview" // exemple Drive
      },

      {
        day: 5,
        anecdote: "Quand j'√©tait jeune, j‚Äôai √©t√© DJ sur Radio FG",
        answer: "Nicolas SP.",
        video: "https://drive.google.com/file/d/1LeM25lT1PX58rmunVNCw4XyPkWLBTjNi/preview" // exemple Drive
      },
            {
        day: 6,
        anecdote: "Enfant, pour √©viter un contr√¥le de maths, j'ai simul√© un mal de ventre et on m'a op√©r√© de l'appendicite",
        answer: "Maxime P.",
        video: "https://drive.google.com/file/d/1y--ERYWWyXkCw2N9XdXx4twI9no-v0A7/preview" // exemple Drive
      },
      {
        day: 7,
        anecdote: "J'ai eu un accident de voiture avec l'auto-√©cole en m'arr√™tant brusquement au feu orange",
        answer: "Anna",
        video: "https://drive.google.com/file/d/12bNvNj5D8Kkxfi8p6anS90c3FwxJD4Ax/preview" // exemple Drive
      },
            {
        day: 8,
        anecdote: "L‚Äôa√©rospatial et l‚Äôaviation me passionnent",
        answer: "Anselme",
        video: "https://drive.google.com/file/d/1V5UhufoA68E9b_pIlL8NMJ2ThqcDrlml/preview" // exemple Drive
      },
      {
        day: 9,
        anecdote: "Le chocolat noir me fait √©ternuer... Je fais partie des rares personnes dans le monde √† ne pas aimer le chocolat !",
        answer: "T√©lio",
        video: "https://drive.google.com/file/d/1woX4ds-f3ZpSaHX1l8UwJIC8QxsWwTvL/preview" // exemple Drive
      },

      {
        day: 10,
        anecdote: "J'ai perdu 1/4 d'un doigt dans une porte, il ne me reste qu'9.75 doigts",
        answer: "Lily",
        video: "https://drive.google.com/file/d/1P2_GDFqWv4iMK3SN-dMAE3JngLfcUc-W/preview" // exemple Drive
      },
      {
        day: 11,
        anecdote: "Ma cam√©ra de visio s'est branch√©e alors que j'√©tais sous la douche",
        answer: "Michael",
        video: "https://drive.google.com/file/d/11_Aba4EeQf-gKC-ofLVTCFg0jz-1yVx2/preview" // exemple Drive
      },

      {
        day: 12,
        anecdote: "J'ai d√©j√† nag√© avec dix bullsharks √† Miami",
        answer: "Romain P.",
        video: "https://drive.google.com/file/d/1r-R4XO2IfXFyR5AjIets-OzEodT5kKsQ/preview" // exemple Drive
      },
            {
        day: 13,
        anecdote: "J'ai regard√© Friends 16 fois, soit l'√©quivalent de 58 jours de ma vie... et je rigole toujours aux m√™mes blagues !",
        answer: "Nathalie",
        video: "https://drive.google.com/file/d/1BN49NXXPEqEsaswnjbXBLEcJNa0vJF3j/preview" // exemple Drive
      },
      {
        day: 14,
        anecdote: "Je fais partie des 0,001 % des auditeurs de Drake sur Spotify",
        answer: "Gr√©goire",
        video: "https://drive.google.com/file/d/14OGfGfmI3fx9JIunTwesCmQd2Hhfo-iQ/preview" // exemple Drive
      },
      {
        day: 15,
        anecdote: "J‚Äôai fait huit ans de fl√ªte traversi√®re",
        answer: "Briac",
        video: "https://drive.google.com/file/d/10GAPMQlEOFWYmohG5eNDm3GvNBCwxW07/preview" // exemple Drive
      },
      {
        day: 16,
        anecdote: "J'ai v√©cu un gros tremblement de terre, pendant mon voyage de noces",
        answer: "Victor",
        video: "https://drive.google.com/file/d/1e1WME9q6AsJq95r2F85vGPJtyd2wp8Zi/preview" // exemple Drive
      },
      {
        day: 17,
        anecdote: "√† changer",
        answer: "Annabelle",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },

      {
        day: 18,
        anecdote: "J'ai mis le feu √† la cuisine d'une amie en faisant des Arancini",
        answer: "Nicolas R.",
        video: "https://drive.google.com/file/d/1l4QEBYzF59FX_yLvdmimxOk78s_iJk9T/preview" // exemple Drive
      },
      {
        day: 19,
        anecdote: "Je me suis retrouv√© √† l‚Äôurinoir √† cot√© de Di Caprio en boite √† LA en 2006",
        answer: "Nicolas P.",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },
      {
        day: 20,
        anecdote: "√† changer",
        answer: "Mathieu",
        video: "https://drive.google.com/file/d/1d_hv6Ce41DNRqGThYboTT7j3qjeGhJh_/preview" // exemple Drive
      },
      {
        day: 21,
        anecdote: "√† changer",
        answer: "Annabelle",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },
      {
        day: 22,
        anecdote: "√† changer",
        answer: "Annabelle",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },
      {
        day: 23,
        anecdote: "√† changer",
        answer: "Annabelle",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },
      {
        day: 24,
        anecdote: "√† changer",
        answer: "Annabelle",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },

    ];

    /**********************
     * √âTAT & PERSISTENCE *
     **********************/
    const STORAGE_KEY = "advent-quiz-v1";
    const state = { dev:false, score:0, opened:{} };

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) Object.assign(state, JSON.parse(raw));
      }catch(_){}
    }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    /**************
     * UTILITAIRE *
     **************/
    const today = new Date();
    const month = today.getMonth()+1;
    const date = today.getDate();
    function isUnlocked(day){ return state.dev || (month===12 && day<=date); }
    function $(id){ return document.getElementById(id); }
    function el(tag, attrs={}, children=[]){
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v])=>{
        if(k==="class") node.className=v;
        else if(k==="text") node.textContent=v;
        else node.setAttribute(k,v);
      });
      [].concat(children).forEach(c=> node.appendChild(typeof c==="string" ? document.createTextNode(c) : c));
      return node;
    }
    function norm(s){ return (s||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(); }
    function check(day, guess){
      const d = DAYS.find(x=>x.day===day);
      const target = norm(d.answer);
      const aliases = (d.aliases||[]).map(norm);
      const g = norm(guess);
      return g===target || aliases.includes(g);
    }

    /************
     *  RENDER  *
     ************/
    const grid = $("grid");

    function renderGrid(){
      grid.innerHTML = "";
      // Ordre al√©atoire √† l‚Äôaffichage
      const order = [...DAYS].sort(()=> Math.random() - 0.5);

      order.forEach(d=>{
        const opened = !!state.opened[d.day];
        const door = el("button", {
          class:`door ${!isUnlocked(d.day)?'locked':''} ${opened?'opened':''}`,
          "data-day":d.day
        });
        door.appendChild(el("span", {class:"badge", text: ""}));
        const dayLabel = String(d.day).padStart(2,'0');
        door.appendChild(el("div", {class:"num", text:dayLabel}));
        
        const img = el("img", {class:"icon", src: DAY_IMAGES[d.day] || "", alt:""});
        door.appendChild(img);
        
        door.addEventListener("click", ()=>{ if(!isUnlocked(d.day)) return; openModal(d.day); });
        grid.appendChild(door);
      });
    }

    /************
     *  MODAL   *
     ************/
    const backdrop = $("backdrop"),
          modalBox = $("modalBox"),
          modalTitle = $("modal-title"),
          anecdote = $("anecdote"),
          answerSelect = $("answerSelect"),
          submitBtn = $("submit"),
          result = $("result"),
          mediaBox = $("media");

    let currentDay = 1;

    function buildOptions(){
      answerSelect.innerHTML = "";
      answerSelect.appendChild(el("option",{value:"", text:"‚Äî S√©lectionne un nom ‚Äî"}));
      TEAM.forEach(name => answerSelect.appendChild(el("option",{value:name, text:name})));
    }

    function openModal(day){
      currentDay = day;
      const d = DAYS.find(x=>x.day===day);
      modalTitle.textContent = String(day).padStart(2,'0');
      anecdote.textContent = d.anecdote;
      buildOptions();

      const saved = state.opened[day] || {};
      answerSelect.value = saved.answer || "";
      result.textContent = "";
      result.className = "result";
      mediaBox.style.display = "none";
      mediaBox.innerHTML = "";

      backdrop.style.display = "flex";
    }
    function closeModal(){ backdrop.style.display = "none"; }
    $("close").addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e)=>{ if(e.target===backdrop) closeModal(); });

    submitBtn.addEventListener("click", ()=>{
      const guess = answerSelect.value;
      if(!guess){
        result.textContent = "Choisis un nom avant de valider";
        result.className = "result ko";
        return;
      }

      const good = check(currentDay, guess);
      state.opened[currentDay] = { answer: guess, correct: good };

      if (good) {
        const d = DAYS.find(x => x.day === currentDay);

        // Nouveau message incitatif (plus de "R√©ponse : ...")
        result.className = "result ok";
        result.innerHTML = `
          <div class="win-msg">
            <strong>Bien jou√©&nbsp;! üéâ</strong> C‚Äô√©tait <strong>${d.answer}</strong>.
            <div class="watch-tip">üé¨ Regarde la vid√©o ci-dessous pour d√©couvrir son FunFact&nbsp;!</div>
          </div>
        `;

        // Affichage de la vid√©o si configur√©e
        if (d.video) {
          if (d.video.trim().toLowerCase().endsWith('.mp4')) {
            mediaBox.innerHTML = `<video controls playsinline src="${d.video}"></video>`;
          } else {
            mediaBox.innerHTML = `<iframe src="${d.video}" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
          }
          mediaBox.style.display = 'block';
          mediaBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        celebrate();

      } else {
        result.className = "result ko";
        result.textContent = "Loup√©‚Ä¶! Essaie quelqu‚Äôun d‚Äôautre üòâ";
        modalBox.classList.add("shake");
        setTimeout(()=> modalBox.classList.remove("shake"), 400);
      }

      state.score = Object.values(state.opened).filter(x=>x.correct).length;
      save();
      renderGrid();
    });

    /*****************
     *  TOOLBAR BTN  *
     *****************/
    $("reset").addEventListener("click", ()=>{
      if(confirm("R√©initialiser tes r√©ponses ?")){
        state.opened = {};
        state.score = 0;
        save(); renderGrid();
      }
    });
    $("toggle-dev").addEventListener("click", ()=>{
      state.dev = !state.dev;
      save(); renderGrid();
      $("toggle-dev").textContent = state.dev ? "Mode test (ON)" : "Mode test";
    });

    /****************
     *  CONFETTIS   *
     ****************/
    const confettiCanvas = $("confetti");
    const ctx = confettiCanvas.getContext('2d');
    let particles = [];
    function resize(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();

    function celebrate(){
      for(let i=0;i<160;i++){
        particles.push({x:Math.random()*confettiCanvas.width, y:-10, s:Math.random()*6+2, v:Math.random()*3+2, r:Math.random()*360, a:1});
      }
      requestAnimationFrame(tick);
      setTimeout(()=>{ particles=[]; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }, 1500);
    }
    function tick(){
      ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      particles.forEach(p=>{
        p.y += p.v; p.r += 6; p.a -= 0.01;
        ctx.save();
        ctx.translate(p.x,p.y); ctx.rotate(p.r*Math.PI/180);
        ctx.globalAlpha = Math.max(p.a, 0);
        const c = Math.floor(p.r)%3;
        ctx.fillStyle = c===0? '#e0b567' : (c===1? '#2d8a6a' : '#b51212');
        ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);
        ctx.restore();
      });
      if(particles.some(p=>p.a>0)) requestAnimationFrame(tick);
    }

    /********
     * INIT *
     ********/
    (function init(){
      load();
      const pad = n=> String(n).padStart(2,'0');
      const now = new Date();
      const fmt = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()}`;
      $("today-pill").textContent = `Aujourd‚Äôhui : ${fmt}`;
      renderGrid();

      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('mode') === 'test') {
          state.dev = true;
          save();
          $('toggle-dev').textContent = 'Mode test (ON)';
  
      } else {
     
          $('toggle-dev').style.display = 'none';
          $('reset').style.display = 'none';
      }
    })();
  </script>
</body>
</html>
