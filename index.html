<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendrier de lâ€™Avent Cambon Partners</title>

  <!-- Police script pour le sous-titre -->
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Palette & tokens */
      --bg:#F5ECE2;          /* Fond beige principal */
      --card:#F5ECE2;        /* Fond clair des cartes et du modal */
      --ink:#2b1f1f;         /* Texte principal */
      --muted:#7f8aa3;       /* Texte secondaire */
      --accent:#e0b567;      /* DorÃ© (confettis/dÃ©tails) */
      --accent-2:#2d8a6a;    /* Vert succÃ¨s */
      --danger:#b51212;      /* Rouge erreur */
      --red:#BE1917;         /* Rouge Ã©lÃ©gant */
      --shadow:0 8px 18px rgba(0,0,0,.10); /* Ombre douce */
    }

    html, body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:"Times New Roman", serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    *{ box-sizing:border-box; }

    .wrap{
      max-width:1100px;
      margin:64px auto 0;
      padding:0 20px;
    }

    /* Header */
    .title{
      text-align:center;
      font-size:54px;
      font-weight:500;
      color:var(--red);
      line-height:1.25;
    }
    .subtitle{
      text-align:center;
      font-family:"Parisienne", cursive;
      font-size:40px;
      color:var(--red);
      margin-top:6px;
    }

    /* Toolbar */
    .toolbar{
      display:flex;
      gap:12px;
      justify-content:flex-end;
      max-width:1100px;
      margin:28px auto 24px;
      padding:0 20px;
    }
    .pill{
      background:rgba(255,255,255,.4);
      border:1px solid rgba(0,0,0,.08);
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      color:#6c6a6a;
    }
    .btn{
      background:#000;
      color:#fff;
      border-radius:6px;
      border:none;
      padding:8px 14px;
      font-weight:600;
      cursor:pointer;
      transition:background .2s ease;
    }
    .btn:hover{ transform:translateY(-1px); }

    /* Grille */
    .grid{
      display:grid;
      grid-template-columns:repeat(6, minmax(120px, 1fr));
      gap:18px;
      margin-top:28px;
    }
    @media (max-width:900px){ .grid{ grid-template-columns:repeat(4, minmax(100px,1fr)); } }
    @media (max-width:600px){ .grid{ grid-template-columns:repeat(3, minmax(90px,1fr)); } }

    .door{
      position:relative;
      background:var(--card);
      border:none;
      height:120px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:200;
      font-size:48px;
      letter-spacing:.5px;
      box-shadow:var(--shadow);
      overflow:hidden;
      transition:all .2s ease-in-out;
      color:var(--red);
      cursor:pointer;
      font-family:"Times New Roman";
    }
    .door:hover:not(.opened){
      box-shadow:0 10px 18px rgba(0,0,0,.12);
      transform:translateY(-2px);
    }
    .door.locked{
      cursor:not-allowed;
      filter:none;
      opacity:1;
    }
    .door.opened{
      background:#F5ECE2;
      box-shadow:none;
      border:none;
    }
    .door .num{
      position:absolute;
      top:8px; left:10px;
      color:var(--red);
      font-size:32px;
      font-weight:500;
    }
    .door.opened .num{ color:#D9A0A0; }

    
    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0;
      background:none;
      backdrop-filter:blur(6px);
      display:none;
      align-items:flex-start; justify-content:center;
      padding-top:12vh; z-index:50;
    }
    .modal{
      width:min(760px, calc(100vw - 32px));
      background:#F4ECE3;
      border:1px solid rgba(0,0,0,.08);
      border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,.12);
      overflow:hidden;
      color:var(--ink);
      transform:translateY(0);
      transition:transform .25s ease;
      font-family:"Times New Roman", serif;
    }
    .modal.shake{ animation:shake .3s ease; }
    @keyframes shake{
      0%{transform:translateX(0)} 20%{transform:translateX(-8px)}
      40%{transform:translateX(8px)} 60%{transform:translateX(-5px)}
      80%{transform:translateX(5px)} 100%{transform:translateX(0)}
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:20px 33px;
    }
    .modal-title{
      font-size:64px; font-weight:500; color:var(--red);
      letter-spacing:.5px;
    }
    .modal-close{
      background:transparent; border:none; font-size:24px; color:#846;
      cursor:pointer;
    }
    .modal-body{ padding:10px 33px 20px; }

    .anecdote{
      background:none;
      border:none;
      padding:8px 0 12px;
      font-size:18px;
      line-height:1.6;
      color:#BE1917;
    }

    .form{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:18px;
    }
    .hint{
      font-family:"Parisienne";
      font-size:20px;
      color:#2b1f1f;
      margin-bottom:4px;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
    }
    @media (max-width:560px){ .row{ flex-direction:column; align-items:stretch; } }

    select{
      flex:1;
      padding:8px 10px;
      border-radius:6px;
      border:1px solid rgba(0,0,0,.2);
      background:#F4ECE3;
      color:#2b1f1f;
      font-family:"Times New Roman", serif;
      font-size:15px;
      outline:none;
    }

    .result{ margin-top:10px; font-weight:700; }
    .ok{ color:var(--accent-2); }
    .ko{ color:var(--danger); }

    .media{
      display:none; margin-top:14px;
    }
    .media iframe, .media video{
      width:100%; aspect-ratio:16/9; border:0; border-radius:12px;
      background:#000;
      animation:popIn .6s ease;
    }
    @keyframes popIn{
      from{ opacity:0; transform:scale(.95); }
      to{ opacity:1; transform:scale(1); }
    }

    .footer{ margin-top:12px; display:flex; justify-content:flex-end; }

    /* Petit style pour le message gagnant */
    .win-msg{ margin-top:8px; }
    .watch-tip{ margin-top:4px; font-style:italic; opacity:.85; }

    /* Confettis */
    .confetti{ position:fixed; pointer-events:none; inset:0; overflow:hidden; z-index:60; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">Le Calendrier de lâ€™Avent Cambon Partners</div>
    <div class="subtitle">Ã€ qui appartient le FunFact du jour ?</div>

    <div class="grid" id="grid"></div>
  </div>

  <div class="toolbar">
    <span class="pill" id="today-pill"></span>
    <button class="btn" id="toggle-dev">Mode test</button>
    <button class="btn" id="reset">RÃ©initialiser</button>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" id="modalBox">
      <div class="modal-head">
        <div class="modal-title" id="modal-title">01</div>
        <button class="modal-close" id="close">Ã—</button>
      </div>

      <div class="modal-body">
        <div class="anecdote" id="anecdote"></div>

        <div class="form">
          <label class="hint">Ã€ qui appartient ce FunFact ?</label>
          <div class="row">
            <select id="answerSelect"></select>
            <button class="btn" id="submit">Valider</button>
          </div>

          <div class="result" id="result"></div>

          <!-- Zone mÃ©dia (vidÃ©o YouTube/Drive ou MP4) -->
          <div class="media" id="media"></div>
        </div>

        <div class="footer"></div>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="confetti"></canvas>

  <script>
    /***************
     * CONFIG TEAM *
     ***************/
    const TEAM = [
     "AdÃ¨le","Alain","Alexandra","Alexandre A.","Alexandre C.","Alexandre H.","AmÃ©lie","Anna","Annabelle","Anselme","Aubert",
     "Baptiste","Briac","Camille","Carine","Chadi","David","Elena","Florian","GaianÃ©","Gabriel","GrÃ©goire","Guillaume E.",
     "Guillaume T.","Jeremy","Jonathan","Jordan","Julien","Juliette","Laurent","Lily","Louis","Luca","Marius","Mathieu","Maxime",
     "Maxime P.","Michael","Min","Morgann","Mostapha","Nathalie","Nicolas O.","Nicolas P.","Nicolas R.","Nicolas SP.","Paul","Pauline",
     "Pierre","RaphaÃ«l","Robin","Romain D","Romain P.","Simon","TÃ©lio","Thomas A.","Thomas B.","Thomas K.","Victor","Yahia","Younes","Yvette"
    ];

    /********************
     * 24 JOURS (dÃ©mo)  *
     ********************/
    const DAYS = [
      {
        day: 1,
        anecdote: "Quand jâ€™Ã©tais petite, je me suis faite renverser par un dromadaire au cirque ðŸ˜…",
        answer: "Annabelle",
        video: "https://drive.google.com/file/d/15Gj59tLS7MNQedKnMZBJb46EtlxWSJhR/preview" // exemple Drive
      },
      ...Array.from({length:23}, (_,i)=>({
        day: i+2,
        anecdote: `Anecdote du jour ${i+2} â€” Ã  personnaliser plus tard.`,
        answer: TEAM[i+1] || TEAM[0],
        aliases: TEAM[i+1] ? [TEAM[i+1], TEAM[i+1].toLowerCase()] : [],
        video: "" // Renseigne un lien YouTube/Drive (embed) ou .mp4 si besoin
      }))
    ];

    /**********************
     * Ã‰TAT & PERSISTENCE *
     **********************/
    const STORAGE_KEY = "advent-quiz-v1";
    const state = { dev:false, score:0, opened:{} };

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) Object.assign(state, JSON.parse(raw));
      }catch(_){}
    }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    /**************
     * UTILITAIRE *
     **************/
    const today = new Date();
    const month = today.getMonth()+1;
    const date = today.getDate();
    function isUnlocked(day){ return state.dev || (month===12 && day<=date); }
    function $(id){ return document.getElementById(id); }
    function el(tag, attrs={}, children=[]){
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v])=>{
        if(k==="class") node.className=v;
        else if(k==="text") node.textContent=v;
        else node.setAttribute(k,v);
      });
      [].concat(children).forEach(c=> node.appendChild(typeof c==="string" ? document.createTextNode(c) : c));
      return node;
    }
    function norm(s){ return (s||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase(); }
    function check(day, guess){
      const d = DAYS.find(x=>x.day===day);
      const target = norm(d.answer);
      const aliases = (d.aliases||[]).map(norm);
      const g = norm(guess);
      return g===target || aliases.includes(g);
    }

    /************
     *  RENDER  *
     ************/
    const grid = $("grid");

    function renderGrid(){
      grid.innerHTML = "";
      // Ordre alÃ©atoire Ã  lâ€™affichage
      const order = [...DAYS].sort(()=> Math.random() - 0.5);

      order.forEach(d=>{
        const opened = !!state.opened[d.day];
        const door = el("button", {
          class:`door ${!isUnlocked(d.day)?'locked':''} ${opened?'opened':''}`,
          "data-day":d.day
        });
        door.appendChild(el("span", {class:"badge", text: ""}));
        const dayLabel = String(d.day).padStart(2,'0');
        door.appendChild(el("div", {class:"num", text:dayLabel}));
        door.addEventListener("click", ()=>{ if(!isUnlocked(d.day)) return; openModal(d.day); });
        grid.appendChild(door);
      });
    }

    /************
     *  MODAL   *
     ************/
    const backdrop = $("backdrop"),
          modalBox = $("modalBox"),
          modalTitle = $("modal-title"),
          anecdote = $("anecdote"),
          answerSelect = $("answerSelect"),
          submitBtn = $("submit"),
          result = $("result"),
          mediaBox = $("media");

    let currentDay = 1;

    function buildOptions(){
      answerSelect.innerHTML = "";
      answerSelect.appendChild(el("option",{value:"", text:"â€” SÃ©lectionne un nom â€”"}));
      TEAM.forEach(name => answerSelect.appendChild(el("option",{value:name, text:name})));
    }

    function openModal(day){
      currentDay = day;
      const d = DAYS.find(x=>x.day===day);
      modalTitle.textContent = String(day).padStart(2,'0');
      anecdote.textContent = d.anecdote;
      buildOptions();

      const saved = state.opened[day] || {};
      answerSelect.value = saved.answer || "";
      result.textContent = "";
      result.className = "result";
      mediaBox.style.display = "none";
      mediaBox.innerHTML = "";

      backdrop.style.display = "flex";
    }
    function closeModal(){ backdrop.style.display = "none"; }
    $("close").addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e)=>{ if(e.target===backdrop) closeModal(); });

    submitBtn.addEventListener("click", ()=>{
      const guess = answerSelect.value;
      if(!guess){
        result.textContent = "Choisis un nom avant de valider";
        result.className = "result ko";
        return;
      }

      const good = check(currentDay, guess);
      state.opened[currentDay] = { answer: guess, correct: good };

      if (good) {
        const d = DAYS.find(x => x.day === currentDay);

        // Nouveau message incitatif (plus de "RÃ©ponse : ...")
        result.className = "result ok";
        result.innerHTML = `
          <div class="win-msg">
            <strong>Bien jouÃ©&nbsp;! ðŸŽ‰</strong> Câ€™Ã©tait <strong>${d.answer}</strong>.
            <div class="watch-tip">ðŸŽ¬ Regarde la vidÃ©o ci-dessous pour dÃ©couvrir son FunFact&nbsp;!</div>
          </div>
        `;

        // Affichage de la vidÃ©o si configurÃ©e
        if (d.video) {
          if (d.video.trim().toLowerCase().endsWith('.mp4')) {
            mediaBox.innerHTML = `<video controls playsinline src="${d.video}"></video>`;
          } else {
            mediaBox.innerHTML = `<iframe src="${d.video}" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
          }
          mediaBox.style.display = 'block';
          mediaBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        celebrate();

      } else {
        result.className = "result ko";
        result.textContent = "LoupÃ©â€¦! Essaie quelquâ€™un dâ€™autre ðŸ˜‰";
        modalBox.classList.add("shake");
        setTimeout(()=> modalBox.classList.remove("shake"), 400);
      }

      state.score = Object.values(state.opened).filter(x=>x.correct).length;
      save();
      renderGrid();
    });

    /*****************
     *  TOOLBAR BTN  *
     *****************/
    $("reset").addEventListener("click", ()=>{
      if(confirm("RÃ©initialiser tes rÃ©ponses ?")){
        state.opened = {};
        state.score = 0;
        save(); renderGrid();
      }
    });
    $("toggle-dev").addEventListener("click", ()=>{
      state.dev = !state.dev;
      save(); renderGrid();
      $("toggle-dev").textContent = state.dev ? "Mode test (ON)" : "Mode test";
    });

    /****************
     *  CONFETTIS   *
     ****************/
    const confettiCanvas = $("confetti");
    const ctx = confettiCanvas.getContext('2d');
    let particles = [];
    function resize(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();

    function celebrate(){
      for(let i=0;i<160;i++){
        particles.push({x:Math.random()*confettiCanvas.width, y:-10, s:Math.random()*6+2, v:Math.random()*3+2, r:Math.random()*360, a:1});
      }
      requestAnimationFrame(tick);
      setTimeout(()=>{ particles=[]; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }, 1500);
    }
    function tick(){
      ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      particles.forEach(p=>{
        p.y += p.v; p.r += 6; p.a -= 0.01;
        ctx.save();
        ctx.translate(p.x,p.y); ctx.rotate(p.r*Math.PI/180);
        ctx.globalAlpha = Math.max(p.a, 0);
        const c = Math.floor(p.r)%3;
        ctx.fillStyle = c===0? '#e0b567' : (c===1? '#2d8a6a' : '#b51212');
        ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);
        ctx.restore();
      });
      if(particles.some(p=>p.a>0)) requestAnimationFrame(tick);
    }

    /********
     * INIT *
     ********/
    (function init(){
      load();
      const pad = n=> String(n).padStart(2,'0');
      const now = new Date();
      const fmt = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()}`;
      $("today-pill").textContent = `Aujourdâ€™hui : ${fmt}`;
      renderGrid();
    })();
  </script>
</body>
</html>
