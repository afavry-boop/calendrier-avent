<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendrier de l'Avent ‚Äì Devine le/la coll√®gue</title>
  <style>
    :root{
      --bg:#0c111d;          /* bleu nuit profond */
      --card:#151c2f;        /* carte sombre */
      --muted:#7f8aa3;       /* gris bleut√© */
      --accent:#e0b567;      /* dor√© */
      --accent-2:#24b47e;    /* vert succ√®s */
      --danger:#e35d6a;      /* rouge erreur */
      --snow:#f7f9fc;
      --shadow: 0 10px 24px rgba(0,0,0,.25);
      --radius: 18px;
    }
    html, body{
      margin:0; background:linear-gradient(180deg, #0a0f1a 0%, #0c111d 40%, #09101b 100%);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--snow);
    }
    .wrap{max-width:1100px; margin:32px auto; padding:0 20px;}
    .header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px;}
    .title{font-size:28px; font-weight:800; letter-spacing:.2px}
    .subtitle{font-size:14px; color:var(--muted)}

    .toolbar{display:flex; align-items:center; gap:10px;}
    .pill{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); padding:8px 12px; border-radius:999px; font-size:12px; color:var(--muted)}
    .btn{appearance:none; border:none; cursor:pointer; padding:10px 14px; border-radius:12px; background:var(--card); color:var(--snow); border:1px solid rgba(255,255,255,.12); box-shadow: var(--shadow); font-weight:600}
    .btn:hover{transform:translateY(-1px);}

    .grid{display:grid; grid-template-columns: repeat(6, minmax(120px, 1fr)); gap:14px;}
    @media (max-width:900px){.grid{grid-template-columns: repeat(4, minmax(100px, 1fr));}}
    @media (max-width:600px){.grid{grid-template-columns: repeat(3, minmax(90px, 1fr));}}

    .door{position:relative; background:linear-gradient(160deg, #1b2542, #121a31); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); height:120px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:28px; letter-spacing:.5px; box-shadow: var(--shadow); overflow:hidden}
    .door.locked{filter:saturate(.4) brightness(.8); cursor:not-allowed}
    .door.opened{background:linear-gradient(160deg, #1f2a4b, #16203a);}    
    .badge{position:absolute; top:10px; left:10px; font-size:10px; padding:6px 8px; border-radius:999px; background:rgba(224,181,103,.15); border:1px solid rgba(224,181,103,.55); color:#fbe4b6;}

    .modal-backdrop{position:fixed; inset:0; background:rgba(5,8,13,.55); backdrop-filter: blur(6px); display:none; align-items:center; justify-content:center; z-index:50}
    .modal{width:min(680px, calc(100vw - 32px)); background:var(--card); border:1px solid rgba(255,255,255,.12); border-radius:22px; box-shadow: var(--shadow); overflow:hidden}
    .modal-head{display:flex; align-items:center; justify-content:space-between; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.08)}
    .modal-title{font-size:18px; font-weight:800}
    .modal-close{background:transparent; border:none; color:var(--muted); font-size:22px; cursor:pointer}
    .modal-body{padding:18px}
    .anecdote{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); padding:14px 16px; border-radius:14px; line-height:1.5;}

    .form{display:grid; gap:12px; margin-top:14px}
    .row{display:grid; gap:10px; grid-template-columns: 1fr 140px}
    @media(max-width:560px){.row{grid-template-columns:1fr}}
    select, input[type="text"], textarea{width:100%; background:#0e1424; color:var(--snow); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:10px 12px; font-size:14px}
    textarea{min-height:72px; resize:vertical}
    .hint{font-size:12px; color:var(--muted)}

    .result{margin-top:10px; font-weight:700}
    .ok{color:var(--accent-2)}
    .ko{color:var(--danger)}
    .reveal{display:none; margin-top:12px; padding:10px 12px; border:1px dashed rgba(255,255,255,.18); border-radius:12px;}

    .footer{margin-top:18px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{font-size:11px; padding:6px 8px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); color:var(--muted)}

    .confetti{position:fixed; pointer-events:none; inset:0; overflow:hidden; z-index:60}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <div class="title">Calendrier de l‚ÄôAvent ‚Ä¢ Devine le/la coll√®gue</div>
        <div class="subtitle">Chaque jour de d√©cembre, ouvre la case, lis l‚Äôanecdote et propose le nom du/de la collaborateur¬∑rice ‚ú®</div>
      </div>
      <div class="toolbar">
        <span class="pill" id="today-pill"></span>
        <button class="btn" id="toggle-dev">Mode test</button>
        <button class="btn" id="reset">R√©initialiser</button>
      </div>
    </div>

    <div class="grid" id="grid"></div>

    <div class="chips" style="margin-top:14px">
      <span class="chip">Autosave dans le navigateur</span>
      <span class="chip">Sans serveur</span>
      <span class="chip">Int√©grable dans Notion (Embed)</span>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-head">
        <div class="modal-title" id="modal-title">Jour 1</div>
        <button class="modal-close" id="close">√ó</button>
      </div>
      <div class="modal-body">
        <div class="anecdote" id="anecdote"></div>

        <div class="form">
          <label class="hint">Ta proposition (devine √† qui appartient l‚Äôanecdote) :</label>
          <div class="row">
            <select id="answerSelect"></select>
            <button class="btn" id="submit">Valider</button>
          </div>

          <label class="hint">Un message sympa (optionnel) √† laisser √† la personne :</label>
          <textarea id="note" placeholder="Ex. : Trop dr√¥le ! Je parie que c‚Äôest toi üòÑ"></textarea>
          <div class="hint">Les r√©ponses restent sur <b>ton appareil</b> (localStorage). Rien n‚Äôest envoy√© sur un serveur.</div>

          <div class="result" id="result"></div>
          <div class="reveal" id="reveal"></div>
        </div>

        <div class="footer">
          <div class="hint">Points : <span id="score">0</span></div>
          <button class="btn" id="revealBtn">R√©v√©ler la r√©ponse</button>
        </div>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="confetti"></canvas>

  <script>
    /**********************
     * CONFIG ‚Äì √Ä ADAPTER *
     **********************/
    const TEAM = [
      "Carine", "David", "Annabelle", "Am√©lie", "Gr√©goire", "Romain D", "Mostapha", "Alexandra", "Camille", "Simon",
      "Paul", "Maxime", "Romain P", "Nathalie", "Morgann", "Michael"
    ];

    // 24 anecdotes ‚Äì exemple; mets les tiennes. "answer" = pr√©nom exact affich√© dans TEAM.
    
    const DAYS = [
  {
    day: 1,
    anecdote: "Quand j'√©tait petite, je me suis faite renvers√©e par un drodaire au cirqueüòÖ",
    answer: "Annabelle",
    aliases: ["Nathalie", "Annabelle", "Camille"]
  },
  ...Array.from({length:23}, (_,i)=>({
    day: i+2,
    anecdote: `Anecdote du jour ${i+2} ‚Äî √† personnaliser plus tard.`,
    answer: TEAM[i+1] || TEAM[0],
    aliases: TEAM[i+1] ? [TEAM[i+1], TEAM[i+1].toLowerCase()] : []
  }))
];


    /**********************
     * √âTAT & STOCKAGE     *
     **********************/
    const STORAGE_KEY = "advent-quiz-v1";
    const state = {
      dev:false,
      score:0,
      opened:{} // day -> {answer, correct:boolean, note:string}
    };

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
          const saved = JSON.parse(raw);
          Object.assign(state, saved);
        }
      }catch(_){/* ignore */}
    }
    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      updateScoreUI();
    }

    /**********************
     * UTILITAIRES         *
     **********************/
    const today = new Date();
    // Forcer fuseau CE(S)T approximatif via toLocaleDateString si besoin
    const month = today.getMonth()+1; // 1‚Äì12
    const date = today.getDate();     // 1‚Äì31

    function isUnlocked(day){
      // D√©bloque en d√©cembre jusqu'au jour courant, sauf en mode dev (tout d√©bloqu√©)
      if(state.dev) return true;
      return (month === 12 && day <= date);
    }

    function $(id){return document.getElementById(id)}

    function el(tag, attrs={}, children=[]){
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v])=>{
        if(k==="class") node.className = v; else if(k==="text") node.textContent=v; else node.setAttribute(k, v);
      });
      [].concat(children).forEach(c=> node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
      return node;
    }

    function norm(s){return (s||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim().toLowerCase()}

    function check(day, guess){
      const d = DAYS.find(x=>x.day===day);
      const target = norm(d.answer);
      const aliases = (d.aliases||[]).map(norm);
      const g = norm(guess);
      return g===target || aliases.includes(g);
    }

    /**********************
     * UI ‚Äì GRID           *
     **********************/
    const grid = $("grid");

    function renderGrid(){
      grid.innerHTML = "";
      DAYS.forEach(d=>{
        const opened = !!state.opened[d.day];
        const door = el("button", {class:`door ${!isUnlocked(d.day)?'locked':''} ${opened?'opened':''}`, "data-day":d.day});
        door.appendChild(el("span", {class:"badge", text: opened?"ouvert" : (isUnlocked(d.day)?"dispo" : "verrouill√©")}));
        door.appendChild(el("div", {class:"num", text:d.day}));
        door.addEventListener("click", ()=>{ if(!isUnlocked(d.day)) return; openModal(d.day); });
        grid.appendChild(door);
      });
    }

    /**********************
     * MODAL LOGIC         *
     **********************/
    const backdrop = $("backdrop");
    const modalTitle = $("modal-title");
    const anecdote = $("anecdote");
    const answerSelect = $("answerSelect");
    const submitBtn = $("submit");
    const result = $("result");
    const revealBox = $("reveal");
    const revealBtn = $("revealBtn");
    const note = $("note");

    let currentDay = 1;

    function buildOptions(){
      answerSelect.innerHTML = "";
      const none = el("option", {value:"", text:"‚Äî S√©lectionne un nom ‚Äî"});
      answerSelect.appendChild(none);
      TEAM.forEach(name=>{
        answerSelect.appendChild(el("option", {value:name, text:name}));
      });
    }

    function openModal(day){
      currentDay = day;
      const d = DAYS.find(x=>x.day===day);
      modalTitle.textContent = `Jour ${day}`;
      anecdote.textContent = d.anecdote;
      buildOptions();

      const saved = state.opened[day] || {};
      answerSelect.value = saved.answer || "";
      note.value = saved.note || "";
      result.textContent = "";
      result.className = "result";
      revealBox.style.display = "none";
      revealBox.textContent = `R√©ponse : ${d.answer}`;

      backdrop.style.display = "flex";
    }

    function closeModal(){
      backdrop.style.display = "none";
    }

    $("close").addEventListener("click", closeModal);
    backdrop.addEventListener("click", (e)=>{ if(e.target===backdrop) closeModal(); });

    submitBtn.addEventListener("click", ()=>{
      const guess = answerSelect.value;
      if(!guess){ result.textContent = "Choisis un nom avant de valider"; result.className = "result ko"; return; }
      const good = check(currentDay, guess);
      state.opened[currentDay] = {answer:guess, correct:good, note:note.value||""};
      if(good){
        result.textContent = "Bravo üéâ C‚Äôest la bonne r√©ponse !";
        result.className = "result ok";
        celebrate();
      } else {
        result.textContent = "Mmmh, pas certain¬∑e‚Ä¶ essaie encore üòÑ";
        result.className = "result ko";
      }
      // Recalcul score
      state.score = Object.values(state.opened).filter(x=>x.correct).length;
      save();
      renderGrid();
    });

    revealBtn.addEventListener("click", ()=>{
      const d = DAYS.find(x=>x.day===currentDay);
      revealBox.style.display = "block";
      result.textContent = `C'√©tait ${d.answer} ‚ú®`;
      result.className = "result ok";
    });

    function updateScoreUI(){ $("score").textContent = state.score || 0; }

    $("reset").addEventListener("click", ()=>{
      if(confirm("R√©initialiser tes r√©ponses et le score ?")){
        state.opened = {}; state.score = 0; save(); renderGrid();
      }
    });

    $("toggle-dev").addEventListener("click", ()=>{
      state.dev = !state.dev; save(); renderGrid();
      $("toggle-dev").textContent = state.dev?"Mode test (ON)":"Mode test";
    });

    /**********************
     * CONFETTI minimal    *
     **********************/
    const confettiCanvas = $("confetti");
    const ctx = confettiCanvas.getContext('2d');
    let particles = [];

    function resize(){confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight}
    window.addEventListener('resize', resize); resize();

    function celebrate(){
      // g√©n√®re 150 confettis
      for(let i=0;i<150;i++){
        particles.push({
          x: Math.random()*confettiCanvas.width,
          y: -10,
          s: Math.random()*6+2,
          v: Math.random()*3+2,
          r: Math.random()*360,
          a: 1
        });
      }
      requestAnimationFrame(tick);
      setTimeout(()=>{ particles=[]; ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height); }, 1500);
    }

    function tick(){
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      particles.forEach(p=>{
        p.y += p.v; p.r += 6; p.a -= 0.01;
        ctx.save();
        ctx.translate(p.x, p.y); ctx.rotate(p.r*Math.PI/180);
        ctx.globalAlpha = Math.max(p.a, 0);
        // alternance dor√© / vert / rouge
        const c = Math.floor(p.r)%3;
        ctx.fillStyle = c===0? '#e0b567' : (c===1? '#24b47e' : '#e35d6a');
        ctx.fillRect(-p.s/2, -p.s/2, p.s, p.s);
        ctx.restore();
      });
      if(particles.some(p=>p.a>0)) requestAnimationFrame(tick);
    }

    /**********************
     * INIT                *
     **********************/
    (function init(){
      load();
      const pad = n=> String(n).padStart(2,'0');
      const now = new Date();
      const fmt = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()}`;
      $("today-pill").textContent = `Aujourd‚Äôhui : ${fmt}`;
      renderGrid();
      updateScoreUI();
    })();
  </script>
</body>
</html>
